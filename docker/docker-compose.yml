version: '3'
services:
  kflw_php:
    build: ./php
    volumes:
      - ../.:/var/www/html
    ports:
      - 8033:80
    container_name: kflw_php
    environment:
      WEB_DOCUMENT_ROOT: /var/www/html/public
      WEB_DOCUMENT_INDEX: index.php
      PHP_MEMORY_LIMIT: 4048M
      PHP_UPLOAD_MAX_FILESIZE: 512M
      PHP_POST_MAX_SIZE: 512M
      PHP_DATE_TIMEZONE: Europe/Kiev
      PHP_DISPLAY_ERRORS: 1
      php.xdebug.max_nesting_level: 500
      php.xdebug.var_display_max_data: 10024
    networks:
      - kflw_net


  kflw_mysql:
    build: ./mysql/
    container_name: kflw_mysql
    environment:
      MYSQL_ROOT_PASSWORD: kflw_dbkflw_dbkflw_db
      MYSQL_DATABASE: kflw_db
      TZ: Europe/Kiev
    ports:
      - 3699:3306
    volumes:
      - kflw_mysql_vol-data:/var/lib/mysql
    networks:
      - kflw_net

  kflw_redis:
    image: "redis:alpine"
    container_name: kflw_redis
    networks:
      - kflw_net

  phpmyadmin:
    depends_on:
      - kflw_mysql
    image: phpmyadmin/phpmyadmin
    restart: always
    ports:
      - '8005:80'
    environment:
      PMA_HOST: kflw_mysql
      MYSQL_ROOT_PASSWORD: kflw_dbkflw_dbkflw_db 
    networks:
      - kflw_net

networks:
  kflw_net:

volumes:
  kflw_mysql_vol-data: